---
title: "DescribeAE"
date: "`r Sys.Date()`"
output:
  html_vignette:
    toc: true
    toc_depth: 2
    keep_md: true
vignette: >
  %\VignetteIndexEntry{DescribeAE}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}
---

```{r, include=FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  warning = FALSE,
  message = FALSE,
  results = 'asis'
)
```

```{r setup}
library(Descusmr)
```

# Introduction

Adverse events (AE) are a crucial aspect of clinical trials, providing insight into the safety profile of treatments. The `DescribeAE` package provides functions to summarize and visualize adverse events by different criteria such as **System Organ Class (SOC)**, **Preferred Term (PT)**, and **Grade**.

This vignette demonstrates how to use two core functions:

- `desc_ei_per_soc()`: Summarizes adverse events by **System Organ Class (SOC)** and **Preferred Term (PT)**.
- `desc_ei_per_grade()`: Summarizes adverse events by **grade**, which represents severity.

These functions generate tables that help interpret the distribution of adverse events across different treatment arms in a randomized controlled trial (RCT).

# Toy dataset

Before using these functions, we need to create a toy datasets. Below is an example of how to structure the data.

## Defining the System Organ Class (SOC) and Preferred Term (PT)

```{r}
df_soc_pt <- data.frame(
  soc = c("Arrhythmia", "Myocardial Infarction", "Pneumonia", "Sepsis"),
  pt = c("Cardiac Disorders", "Cardiac Disorders", "Infections", "Infections")
)
```

## Assigning Patients to Treatment Arms

```{r}
df_pat_grp <- data.frame(
  id_pat = paste0("ID_", 1:10),
  grp = c(rep("A", 3), rep("B", 3), rep("C", 4))
)
```

## Recording Adverse Events by SOC and Grade

```{r}
df_pat_soc_grade <- data.frame(
  id_pat = c("ID_1", "ID_1", "ID_2", "ID_4", "ID_9"),
  soc = c("Arrhythmia", "Myocardial Infarction", "Arrhythmia", "Pneumonia", "Pneumonia"),
  grade = c(1, 3, 4, 2, 4)
)
```


# Summarizing Adverse Events

## Describing Adverse Events by System Organ Class

To analyze adverse events based on their **System Organ Class (SOC)** and **Preferred Term (PT)**, use the `desc_ei_per_soc()` function:

```{r}
desc_ei_per_soc(df_soc_pt = df_soc_pt,
                df_pat_grp = df_pat_grp,
                df_pat_soc = df_pat_soc_grade)
```

### Interpretation:

This table shows how frequently different types of adverse events occur within each treatment arm. It helps in identifying which organ systems are most affected and whether certain treatment groups have higher rates of specific adverse events.


## Describing Adverse Events by Grade

To assess the severity of adverse events across treatment arms, use `desc_ei_per_grade()`:

```{r}
desc_ei_per_grade(df_pat_grp = df_pat_grp,
                  df_pat_grade = df_pat_soc_grade)
```

### Interpretation:

This table summarizes the distribution of adverse event grades (severity levels) per treatment group. It helps in understanding whether a treatment is associated with more severe adverse events compared to others.


# What if you have only one group ?

In that case the table `df_pat_grp` must still be provided with grp set to "Total" (or any other string)

```{r}
desc_ei_per_soc(df_soc_pt = df_soc_pt,
                df_pat_grp = df_pat_grp |> dplyr::mutate(grp = "A"),
                df_pat_soc = df_pat_soc_grade)
```

```{r}
desc_ei_per_grade(df_pat_grp = df_pat_grp |> dplyr::mutate(grp = "A"),
                  df_pat_grade = df_pat_soc_grade)
```


# Conclusion

The `DescribeAE` package provides a structured approach to summarizing and visualizing adverse events in clinical trials. By using `desc_ei_per_soc()` and `desc_ei_per_grade()`, researchers can:

- Identify which organ systems are most affected.
- Compare the frequency and severity of adverse events across treatment arms.
- Gain insights into the safety profile of treatments.

These summaries support better decision-making in clinical trial analyses, ensuring a comprehensive evaluation of adverse events. For further customization, users can preprocess their data accordingly before applying these functions.

